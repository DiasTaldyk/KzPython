<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python –ó–∞–¥–∞—á–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    #login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }

    .login-card {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 500px;
      width: 100%;
    }

    .login-card h1 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 2rem;
    }

    .login-card p {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    #login-button {
      background: #0088cc;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 0 auto;
      font-weight: 600;
    }

    #login-button:hover {
      background: #0077b5;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,136,204,0.3);
    }

    .telegram-icon {
      font-size: 24px;
    }

    .error-message {
      background: #ff4757;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
    }

    #app-container {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      animation: fadeIn 0.5s ease;
    }

    .header {
      background: white;
      padding: 25px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .header h1 {
      color: #667eea;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-align: center;
    }

    .user-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 15px;
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid #667eea;
    }

    .user-details h3 {
      color: #333;
      margin-bottom: 5px;
    }

    .user-details p {
      color: #666;
      font-size: 0.9rem;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .control-group {
      background: white;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .control-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #667eea;
      font-size: 1.1rem;
    }

    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .task-section {
      background: white;
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .task-section h3 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    #task-description {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      line-height: 1.8;
      font-size: 1.1rem;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 15px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 16px;
      resize: vertical;
      transition: border-color 0.3s ease;
      margin-bottom: 20px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    button {
      flex: 1;
      min-width: 200px;
      padding: 15px 30px;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .primary-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .secondary-btn {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #e0e0e0;
    }

    .secondary-btn:hover {
      background: #e9ecef;
      transform: translateY(-2px);
    }

    .danger-btn {
      background: #ff4757;
      color: white;
    }

    .danger-btn:hover {
      background: #ff3742;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(255, 71, 87, 0.3);
    }

    #output {
      min-height: 100px;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      font-size: 1.1rem;
      animation: slideIn 0.3s ease;
    }

    .success {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: #155724;
      border-left: 5px solid #28a745;
    }

    .error {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: #721c24;
      border-left: 5px solid #dc3545;
    }

    .loading {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      border-left: 5px solid #ffc107;
    }

    .score-container {
      background: white;
      padding: 25px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    #score {
      font-size: 2.5rem;
      font-weight: bold;
      color: #667eea;
      margin: 10px 0;
    }

    .score-label {
      color: #666;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤—Ç—ñ —Å—Ç–∏–ª—å–¥–µ—Ä */
    @media (max-width: 768px) {
      .login-card {
        padding: 25px;
        margin: 15px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .controls {
        grid-template-columns: 1fr;
      }

      .control-group, .task-section, .score-container {
        padding: 20px;
      }

      textarea {
        min-height: 150px;
        font-size: 14px;
      }

      button {
        min-width: 100%;
      }

      .buttons {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .header {
        padding: 20px;
      }

      .user-info {
        flex-direction: column;
        text-align: center;
      }

      #task-description {
        font-size: 1rem;
        padding: 15px;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è–ª–∞—Ä */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Telegram Web App —Ç“Ø—Ä—ñ “Ø—à—ñ–Ω */
    @media (display-mode: fullscreen) {
      body {
        background: white;
      }

      #app-container {
        padding: 10px;
        max-width: 100%;
      }

      .header {
        border-radius: 0;
        margin-bottom: 20px;
        padding: 20px 15px;
      }

      .task-section {
        border-radius: 0;
        box-shadow: none;
        margin-bottom: 20px;
        padding: 20px 15px;
      }
    }
  </style>
</head>
<body>
  <!-- –ö—ñ—Ä—É –±–µ—Ç—ñ -->
  <div id="login-container">
    <div class="login-card">
      <h1>üë®‚Äçüíª Python –¢—Ä–µ–Ω–∞–∂—ë—Ä</h1>
      <p>–ë“±–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞“ì–∞ –∫—ñ—Ä—É “Ø—à—ñ–Ω Telegram –∞—Ä“õ—ã–ª—ã —Ç—ñ—Ä–∫–µ–ª—É “õ–∞–∂–µ—Ç. –¢”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑:</p>
      <button id="login-button">
        <span class="telegram-icon">üì±</span>
        Telegram –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä—É
      </button>
      <div id="login-error" class="error-message">
        –ö—ñ—Ä—É —Ä“±“õ—Å–∞—Ç—ã –∂–æ“õ. –¢–µ–∫ —Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ–ª–≥–µ–Ω “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä –∫—ñ—Ä–µ –∞–ª–∞–¥—ã.
      </div>
    </div>
  </div>

  <!-- –ù–µ–≥—ñ–∑–≥—ñ “õ–æ–ª–¥–∞–Ω–±–∞ -->
  <div id="app-container">
    <div class="header">
      <h1>Python –¢—Ä–µ–Ω–∞–∂—ë—Ä</h1>
      <div class="user-info" id="user-info">
        <!-- –ú“±–Ω–¥–∞ Telegram “õ–æ–ª–¥–∞–Ω—É—à—ã—Å—ã–Ω—ã“£ –∞“õ–ø–∞—Ä–∞—Ç—ã –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ -->
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
        <label for="difficulty-select">üìä “ö–∏—ã–Ω–¥—ã“õ –¥–µ“£–≥–µ–π—ñ:</label>
        <select id="difficulty-select">
          <option value="easy">–û“£–∞–π</option>
          <option value="medium">–û—Ä—Ç–∞—à–∞</option>
          <option value="hard">“ö–∏—ã–Ω</option>
        </select>
      </div>
      <div class="control-group">
        <label for="task-select">üéØ –¢–∞–ø—Å—ã—Ä–º–∞–Ω—ã —Ç–∞“£–¥–∞—É:</label>
        <select id="task-select"></select>
      </div>
    </div>

    <div class="task-section">
      <h3>–¢–∞–ø—Å—ã—Ä–º–∞ —Å–∏–ø–∞—Ç—Ç–∞–º–∞—Å—ã</h3>
      <div id="task-description">–¢–∞–ø—Å—ã—Ä–º–∞ —Å–∏–ø–∞—Ç—Ç–∞–º–∞—Å—ã –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ...</div>
      
      <textarea id="code" placeholder="–ö–æ–¥—Ç—ã –æ—Å—ã –∂–µ—Ä–≥–µ –∂–∞–∑—ã“£—ã–∑..."></textarea>
      
      <div class="buttons">
        <button class="primary-btn" onclick="runCode()">‚úÖ –¢–µ–∫—Å–µ—Ä—É</button>
        <button class="secondary-btn" onclick="nextTask()">‚û°Ô∏è –ö–µ–ª–µ—Å—ñ —Ç–∞–ø—Å—ã—Ä–º–∞</button>
        <button class="danger-btn" onclick="resetScore()">üîÑ “∞–ø–∞–π–¥—ã “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—É</button>
      </div>
    </div>

    <div id="output"></div>

    <div class="score-container">
      <div class="score-label">–ñ–∏–Ω–∞–ª“ì–∞–Ω “±–ø–∞–π–ª–∞—Ä:</div>
      <div id="score">0</div>
    </div>
  </div>

  <script>
    // –†“±“õ—Å–∞—Ç –±–µ—Ä—ñ–ª–≥–µ–Ω Telegram ID-–ª–µ—Ä —Ç—ñ–∑—ñ–º—ñ
    const ALLOWED_TELEGRAM_IDS = [
      123456789, // –ú“±–Ω–¥–∞ ”©–∑ Telegram ID-–ª–µ—Ä—ñ“£—ñ–∑–¥—ñ “õ–æ—Å—ã“£—ã–∑
      987654321
    ];

    let tasks = [];
    let pyodide;
    let currentTaskIndex = 0;
    let score = parseInt(localStorage.getItem("score")) || 0;
    let telegramUser = null;

    // Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è—Å—ã
    const tg = window.Telegram?.WebApp;

    // Telegram –∫—ñ—Ä—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
    function initTelegramAuth() {
      if (!tg) {
        console.log('Telegram Web App API –∂–æ“õ, –±—Ä–∞—É–∑–µ—Ä —Ä–µ–∂–∏–º—ñ–Ω–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ—É...');
        showAppContent({ 
          id: 999999999, 
          first_name: '“ö–æ–ª–¥–∞–Ω—É—à—ã',
          username: 'demo_user'
        });
        return;
      }

      tg.ready();
      tg.expand();

      const user = tg.initDataUnsafe?.user;
      
      if (user && ALLOWED_TELEGRAM_IDS.includes(user.id)) {
        telegramUser = user;
        showAppContent(user);
      } else {
        showLoginError();
      }
    }

    // –ö—ñ—Ä—É “õ–∞—Ç–µ—Å—ñ–Ω –∫”©—Ä—Å–µ—Ç—É
    function showLoginError() {
      document.getElementById('login-error').style.display = 'block';
      if (tg) {
        tg.showAlert('–°—ñ–∑–≥–µ –∫—ñ—Ä—É —Ä“±“õ—Å–∞—Ç—ã –∂–æ“õ. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä“ì–∞ —Ö–∞–±–∞—Ä–ª–∞—Å—ã“£—ã–∑.');
      } else {
        alert('–ö—ñ—Ä—É —Ä“±“õ—Å–∞—Ç—ã –∂–æ“õ. –¢–µ–∫ —Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ–ª–≥–µ–Ω “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä –∫—ñ—Ä–µ –∞–ª–∞–¥—ã.');
      }
    }

    // “ö–æ–ª–¥–∞–Ω–±–∞ –º–∞–∑–º“±–Ω—ã–Ω –∫”©—Ä—Å–µ—Ç—É
    function showAppContent(user) {
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('app-container').style.display = 'block';
      
      // “ö–æ–ª–¥–∞–Ω—É—à—ã –∞“õ–ø–∞—Ä–∞—Ç—ã–Ω –∫”©—Ä—Å–µ—Ç—É
      document.getElementById('user-info').innerHTML = `
        <img src="${user.photo_url || 'https://via.placeholder.com/50'}" 
             alt="–ê–≤–∞—Ç–∞—Ä" class="user-avatar">
        <div class="user-details">
          <h3>${user.first_name} ${user.last_name || ''}</h3>
          <p>@${user.username || '–∂–æ“õ'}</p>
          <p style="font-size: 0.8rem; color: #667eea;">ID: ${user.id}</p>
        </div>
      `;
      
      document.getElementById('score').textContent = score;
      
      // Pyodide –∂”ô–Ω–µ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ—É
      loadAll();
    }

    // Telegram –∫—ñ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
    document.getElementById('login-button').addEventListener('click', function() {
      if (tg) {
        // Telegram Web App —Ä–µ–∂–∏–º—ñ–Ω–¥–µ
        initTelegramAuth();
      } else {
        // –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–∂–∏–º—ñ–Ω–¥–µ - –¥–µ–º–æ –∫—ñ—Ä—É
        const testUser = {
          id: 999999999,
          first_name: '–°—ã–Ω–∞“õ',
          last_name: '“ö–æ–ª–¥–∞–Ω—É—à—ã',
          username: 'test_user_kz'
        };
        
        const enteredId = prompt('–¢–µ—Å—Ç —Ä–µ–∂–∏–º—ñ: Telegram ID –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑:');
        if (ALLOWED_TELEGRAM_IDS.includes(parseInt(enteredId)) || enteredId === 'demo') {
          showAppContent(testUser);
        } else {
          alert('–ö—ñ—Ä—É —Ä“±“õ—Å–∞—Ç—ã –∂–æ“õ. –¢–µ—Å—Ç “Ø—à—ñ–Ω "demo" –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.');
        }
      }
    });

    // –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–∂–∏–º—ñ–Ω–¥–µ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∫—ñ—Ä—É–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
    if (!tg) {
      setTimeout(() => {
        if (!telegramUser) {
          document.getElementById('login-error').style.display = 'block';
          document.getElementById('login-error').textContent = 
            'Telegram Web App –µ–º–µ—Å. –¢–µ—Å—Ç —Ä–µ–∂–∏–º—ñ “Ø—à—ñ–Ω "Telegram –∞—Ä“õ—ã–ª—ã –∫—ñ—Ä—É" –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –±–∞—Å—ã“£—ã–∑.';
        }
      }, 1000);
    }

    async function loadAll() {
      pyodide = await loadPyodide();

      const savedLevel = localStorage.getItem("level") || "easy";
      const savedIndex = parseInt(localStorage.getItem("taskIndex")) || 0;

      document.getElementById("difficulty-select").value = savedLevel;
      await loadTasks(savedLevel);

      currentTaskIndex = Math.min(savedIndex, tasks.length - 1);
      if (tasks.length > 0) {
        document.getElementById("task-select").selectedIndex = currentTaskIndex;
        updateTaskDisplay();
      }

      document.getElementById("difficulty-select").onchange = async () => {
        const level = document.getElementById("difficulty-select").value;
        localStorage.setItem("level", level);

        document.getElementById("output").innerHTML = '<div class="loading">–¢–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</div>';
        await loadTasks(level);

        currentTaskIndex = 0;
        fillTaskList();
        updateTaskDisplay();
        localStorage.setItem("taskIndex", currentTaskIndex);
      };

      document.getElementById("task-select").onchange = () => {
        currentTaskIndex = parseInt(document.getElementById("task-select").value);
        updateTaskDisplay();
        localStorage.setItem("taskIndex", currentTaskIndex);
      };
    }

    async function loadTasks(level) {
      try {
        const response = await fetch(`tasks_${level}.json`);
        tasks = await response.json();
      } catch (err) {
        tasks = [];
        console.error(`tasks_${level}.json –∂“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ:`, err);
        document.getElementById("output").innerHTML = 
          '<div class="error">–¢–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.</div>';
      }
      fillTaskList();
    }

    function fillTaskList() {
      const select = document.getElementById("task-select");
      select.innerHTML = "";
      tasks.forEach((_, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = `–¢–∞–ø—Å—ã—Ä–º–∞ ‚Ññ${index + 1}`;
        select.appendChild(option);
      });
    }

    function updateTaskDisplay() {
      const task = tasks[currentTaskIndex];
      document.getElementById("task-description").textContent = 
        task?.description || "–°–∏–ø–∞—Ç—Ç–∞–º–∞ –∂–æ“õ";
      document.getElementById("output").innerHTML = "";
      document.getElementById("code").value = localStorage.getItem(getCodeKey()) || "";
    }

    function checkForbidden(code, banned) {
      return banned?.find(word => code.includes(word));
    }

    function checkRequired(code, required) {
      return required?.find(word => !code.includes(word));
    }

    async function runCode() {
      const code = document.getElementById("code").value;
      const task = tasks[currentTaskIndex];
      const solvedKey = getSolvedKey();

      localStorage.setItem(getCodeKey(), code);

      const banned = checkForbidden(code, task.banned);
      if (banned) {
        document.getElementById("output").innerHTML = 
          `<div class="error">“ö–æ–ª–¥–∞–Ω—É“ì–∞ –±–æ–ª–º–∞–π–¥—ã: ${banned}</div>`;
        return;
      }

      const missing = checkRequired(code, task.required);
      if (missing) {
        document.getElementById("output").innerHTML = 
          `<div class="error">–°—ñ–∑ “õ–æ–ª–¥–∞–Ω–±–∞–¥—ã“£—ã–∑: ${missing}</div>`;
        return;
      }

      try {
        document.getElementById("output").innerHTML = 
          '<div class="loading">–ö–æ–¥ –æ—Ä—ã–Ω–¥–∞–ª—É–¥–∞...</div>';

        const output = (await pyodide.runPythonAsync(`
import io, sys
sys.stdout = io.StringIO()
${code}
sys.stdout.getvalue()
        `)).trim();

        if (output === task.expected) {
          if (!localStorage.getItem(solvedKey)) {
            score += 1;
            localStorage.setItem("score", score);
            localStorage.setItem(solvedKey, "true");
            // Telegram-–≥–µ —Ö–∞–±–∞—Ä–ª–∞—É
            if (tg) {
              tg.HapticFeedback.impactOccurred('medium');
            }
          }
          document.getElementById("output").innerHTML = 
            `<div class="success">‚úÖ –î“±—Ä—ã—Å! –ù”ô—Ç–∏–∂–µ: ${output}</div>`;
        } else {
          document.getElementById("output").innerHTML = 
            `<div class="error">‚ùå “ö–∞—Ç–µ. –ê–ª—ã–Ω“ì–∞–Ω: ${output}</div>`;
        }

      } catch (err) {
        document.getElementById("output").innerHTML = 
          `<div class="error">“ö–∞—Ç–µ: ${err.message}</div>`;
      }

      document.getElementById("score").textContent = score;
    }

    function getCodeKey() {
      const level = document.getElementById("difficulty-select").value;
      return `code_${level}_${currentTaskIndex}`;
    }

    function getSolvedKey() {
      const level = document.getElementById("difficulty-select").value;
      return `solved_${level}_${currentTaskIndex}`;
    }

    function nextTask() {
      if (tasks.length === 0) return;
      
      currentTaskIndex = (currentTaskIndex + 1) % tasks.length;
      document.getElementById("task-select").selectedIndex = currentTaskIndex;
      updateTaskDisplay();
      localStorage.setItem("taskIndex", currentTaskIndex);
    }

    function resetScore() {
      score = 0;
      localStorage.setItem("score", "0");
      for (const key in localStorage) {
        if (key.startsWith("solved_")) {
          localStorage.removeItem(key);
        }
      }
      document.getElementById("score").textContent = score;
      document.getElementById("output").innerHTML = 
        `<div class="success">“∞–ø–∞–π–ª–∞—Ä –∂”ô–Ω–µ –ø—Ä–æ–≥—Ä–µ—Å—Å “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ–ª–¥—ñ!</div>`;
    }

    document.getElementById("code").addEventListener("paste", (e) => {
      e.preventDefault();
      if (tg) {
        tg.showAlert("–ö”©—à—ñ—Ä—ñ–ø “õ–æ—é“ì–∞ –±–æ–ª–º–∞–π–¥—ã! ”®–∑—ñ“£—ñ–∑ –∂–∞–∑—ã“£—ã–∑ üí™");
      } else {
        alert("–ö”©—à—ñ—Ä—ñ–ø “õ–æ—é“ì–∞ –±–æ–ª–º–∞–π–¥—ã! ”®–∑—ñ“£—ñ–∑ –∂–∞–∑—ã“£—ã–∑ üí™");
      }
    });

    // –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–∂–∏–º—ñ–Ω–¥–µ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –¥–µ–º–æ –∫—ñ—Ä—É–¥—ñ —ñ—Å–∫–µ “õ–æ—Å—É
    if (window.location.search.includes('demo=true')) {
      showAppContent({ 
        id: 999999999, 
        first_name: '–°—ã–Ω–∞“õ',
        username: 'demo_user'
      });
    }
  </script>
</body>
</html>
